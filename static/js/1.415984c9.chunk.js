(this["webpackJsonpall-in-one"]=this["webpackJsonpall-in-one"]||[]).push([[1],{859:function(e,t,i){"use strict";i.r(t);var a=i(29),n=i(65),s=i(69),o=i(140),d=i(6),r=i(34),c=i(25);let E;!function(e){e.GET_PROGRESS="GET_PROGRESS",e.SET_PROGRESS="SET_PROGRESS",e.PROGRESS_RESPONSE="PROGRESS_RESPONSE",e.VIDEO_COMPLETED="VIDEO_COMPLETED",e.AUDIO_COMPLETED="AUDIO_COMPLETED",e.PAUSE_VIDEO="PAUSE_VIDEO",e.PAUSE_AUDIO="PAUSE_AUDIO"}(E||(E={}));var h=i(16),l=i(233),O=i(83),u=i(13),I=i(234);var S=new class{constructor(){this.iframeOrigin="",this.actions=void 0,this.audioIframeIds=new Set,this.videoIframeIds=new Set,this.parentListener=async e=>{if(this.isDevToolsEvent(e))return;if(this.setIframeOrigin(e),!this.doesOriginMatch(e))return;const t=e.data,i=t.type,a=t.value;if(!a)return;const n=a.videoId,s=a.audioId,o=a.questionId,d=a.progressedTime,c=n||s,h=c.split("_"),l=Object(r.a)(h,3),O=l[0],u=l[1],I=l[2];switch(i){case E.GET_PROGRESS:this.handleGetProgress(c,O,u,I);break;case E.SET_PROGRESS:await this.handleSetProgress(c,O,d,o);break;case E.VIDEO_COMPLETED:case E.AUDIO_COMPLETED:await this.handleMediaCompletion(c,O,o,I);break;default:console.warn("unhandled message type: ".concat(i))}}}initialize(e){this.actions=e,window.addEventListener("message",this.parentListener)}onContentLoaded(e){e.questionIds.forEach(e=>{this.initializeMediaWatchStatus(e),this.markInformationContentExperienced(e)})}onContentQuestionOpen(e){let t=e.questionId;const i=Object(h.t)(n.a.getState(),t).hasMedia;(!i||i&&Object(h.W)(n.a.getState(),t))&&this.actions.informationContentExperienced(t)}pauseMedia(){[...this.videoIframeIds].forEach(e=>{const t=document.getElementById(e);var i;t&&(null===(i=t.contentWindow)||void 0===i||i.postMessage({type:E.PAUSE_VIDEO},this.iframeOrigin))}),[...this.audioIframeIds].forEach(e=>{const t=document.getElementById(e);var i;t&&(null===(i=t.contentWindow)||void 0===i||i.postMessage({type:E.PAUSE_AUDIO},this.iframeOrigin))})}cleanup(){window.removeEventListener("message",this.parentListener)}initializeMediaWatchStatus(e){const t=Object(h.t)(n.a.getState(),e),i=t.audioCount,a=t.videoCount,s=Array(a).fill(!1),o=Array(i).fill(!1);n.a.dispatch({type:l.a.SET_QUESTION_TOTAL_MEDIA_WATCHED,payload:{questionId:e,totalVideosWatched:s,totalAudiosWatched:o}})}markInformationContentExperienced(e){const t=Object(h.t)(n.a.getState(),e).hasMedia,i=Object(h.x)(n.a.getState(),e).type===u.d;Object(h.R)(n.a.getState(),e)&&!Object(h.ib)(n.a.getState(),e)&&!t&&i&&this.actions.informationContentExperienced(e)}markMediaAsWatched(e,t,i,a){if(!a)return;"video"===t?this.videoIframeIds.delete(e):this.audioIframeIds.delete(e);const s=Object(h.u)(n.a.getState(),i),o=s.totalVideosWatched,d=s.totalAudiosWatched;"video"===t?o[a]=!0:d[a]=!0,n.a.dispatch({type:l.a.SET_QUESTION_TOTAL_MEDIA_WATCHED,payload:{questionId:i,totalVideosWatched:o,totalAudiosWatched:d}})}handleGetProgress(e,t,i,a){if(!Object(O.h)(+i)||!Object(O.h)(+a)&&"VO"!==a)return;const n=document.getElementById(e);if(n){var s,o;"video"===t?this.videoIframeIds.add(e):this.audioIframeIds.add(e);const d="video"===t?c.a.getVideoProgress():c.a.getAudioProgress(),r=d&&(null===(s=d[+i])||void 0===s?void 0:s["VO"===a?"VO":+a])||0;null===(o=n.contentWindow)||void 0===o||o.postMessage({type:E.PROGRESS_RESPONSE,value:r},this.iframeOrigin)}}async handleSetProgress(e,t,i,a){if(null===i)return;const s=Object(h.u)(n.a.getState(),a),o=s.totalAudiosWatched,r=s.totalVideosWatched;d.a.emit(d.b.MEDIA_PROGRESSED,{mediaProgress:{mediaId:e,progressedTime:i,totalMediaWatched:"video"===t?r:o,mediaType:t},state:n.a.getState()})}async handleMediaCompletion(e,t,i,a){a&&("VO"===a?n.a.dispatch({type:I.a.MARK_VOICE_OVER_COMPLETED,payload:{questionId:i,voiceOverCompleted:!0}}):(this.markMediaAsWatched(e,t,i,a),Object(h.W)(n.a.getState(),i)&&this.actions.informationContentExperienced(i)))}isDevToolsEvent(e){var t;return null===(t=e.data.source)||void 0===t?void 0:t.includes("react-devtools")}setIframeOrigin(e){const t=e.data.type;!this.iframeOrigin&&Object.values(E).includes(t)&&(this.iframeOrigin=e.origin)}doesOriginMatch(e){return e.origin===this.iframeOrigin}};class p extends o.a{constructor(){super(),this.handlers=void 0,this.handlers=[{event:d.b.MEDIA_RESTRICTION_ON_CONTENT_LOADED,instance:this.onContentLoaded.bind(this)},{event:d.b.MEDIA_RESTRICTION_ON_CONTENT_OPENED,instance:this.onContentQuestionOpen.bind(this)},{event:d.b.MEDIA_RESTRICTION_PAUSE_MEDIA,instance:this.pauseMedia.bind(this)}]}initialize(e){S.initialize(e)}onContentLoaded(e){let t=e.questionIds;S.onContentLoaded({questionIds:t})}onContentQuestionOpen(e){let t=e.questionId;S.onContentQuestionOpen({questionId:t})}pauseMedia(){S.pauseMedia()}cleanup(){S.cleanup()}}t.default=new class{constructor(){this.eventHandler=void 0,this.eventHandler=new p}subscribe(){const e=Object(a.b)(s,n.a.dispatch);this.eventHandler.on(),this.eventHandler.initialize(e)}unsubscribe(){this.eventHandler.off(),this.eventHandler.cleanup()}}}}]);